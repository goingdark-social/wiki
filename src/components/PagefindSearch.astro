---
---

<div id="pagefind-search" class="pagefind-container">
  <div id="search-input-container" class="pagefind-input-wrapper">
    <div class="pagefind-search-icon-wrapper">
      <svg class="pagefind-search-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
      </svg>
    </div>
    <input
      id="pagefind-search-input"
      type="search"
      placeholder="Search documentation..."
      aria-label="Search documentation"
      class="pagefind-input-field"
    />
  </div>
  <div id="pagefind-results" class="pagefind-results-container" role="listbox" aria-label="Search results"></div>
</div>

<script is:inline>
  document.addEventListener('DOMContentLoaded', () => {
    const searchInput = document.getElementById('pagefind-search-input');
    const resultsContainer = document.getElementById('pagefind-results');

    if (!searchInput || !resultsContainer) return;

    let pagefind = null;
    let debounceTimer;

    const loadPagefind = async () => {
      try {
        const module = await import('/pagefind/pagefind.js');
        await module.init();
        return module;
      } catch (error) {
        console.warn('Pagefind not available:', error);
        return null;
      }
    };

    searchInput.addEventListener('input', async (e) => {
      const query = e.target.value;

      clearTimeout(debounceTimer);

      if (!query || query.length < 2) {
        resultsContainer.innerHTML = '';
        resultsContainer.classList.add('pagefind-hidden');
        return;
      }

      debounceTimer = setTimeout(async () => {
        if (!pagefind) {
          pagefind = await loadPagefind();
          if (!pagefind) {
            resultsContainer.innerHTML = '<p class="pagefind-no-results">Search index not available. Run build first.</p>';
            resultsContainer.classList.remove('pagefind-hidden');
            return;
          }
        }

        const search = await pagefind.search(query);

        if (search.results.length === 0) {
          resultsContainer.innerHTML = '<p class="pagefind-no-results">No results found</p>';
          resultsContainer.classList.remove('pagefind-hidden');
          return;
        }

        const resultsHTML = await Promise.all(
          search.results.slice(0, 5).map(async (result) => {
            const data = await result.data();
            return `
              <a
                href="${data.url}"
                class="pagefind-result-item"
                role="option"
              >
                <span class="pagefind-result-title">${data.meta.title || 'Untitled'}</span>
                <span class="pagefind-result-excerpt">${data.excerpt || ''}</span>
              </a>
            `;
          })
        );

        resultsContainer.innerHTML = resultsHTML.join('');
        resultsContainer.classList.remove('pagefind-hidden');
      }, 300);
    });

    document.addEventListener('click', (e) => {
      if (!document.getElementById('pagefind-search')?.contains(e.target)) {
        resultsContainer.classList.add('pagefind-hidden');
      }
    });

    searchInput.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') {
        resultsContainer.classList.add('pagefind-hidden');
        searchInput.blur();
      }
    });
  });
</script>

<style>
  .pagefind-container {
    margin-bottom: var(--space-6);
  }

  .pagefind-input-wrapper {
    position: relative;
  }

  .pagefind-search-icon-wrapper {
    position: absolute;
    inset: 0;
    padding-left: var(--space-3);
    display: flex;
    align-items: center;
    pointer-events: none;
  }

  .pagefind-search-icon {
    width: var(--space-5);
    height: var(--space-5);
    color: var(--color-text-muted);
  }

  .pagefind-input-field {
    width: 100%;
    padding: var(--space-2) var(--space-4) var(--space-2) 2.5rem;
    background-color: var(--color-surface-900);
    border: 1px solid var(--color-surface-700);
    border-radius: var(--radius-sm);
    font-size: var(--font-size-sm);
    color: var(--color-text-white);
    transition: all var(--transition-base);
    min-height: 44px;
  }

  .pagefind-input-field::placeholder {
    color: var(--color-text-muted);
  }

  .pagefind-input-field:focus {
    outline: none;
    border-color: var(--color-primary);
    box-shadow: 0 0 0 2px var(--color-primary);
  }

  .pagefind-input-field:hover {
    border-color: var(--color-surface-600);
  }

  .pagefind-results-container {
    margin-top: var(--space-3);
    display: flex;
    flex-direction: column;
    gap: var(--space-2);
    max-height: 24rem;
    overflow-y: auto;
  }

  .pagefind-results-container.pagefind-hidden {
    display: none;
  }

  .pagefind-results-container:not(.pagefind-hidden) {
    display: flex;
  }

  .pagefind-no-results {
    font-size: var(--font-size-sm);
    color: var(--color-text-muted);
    padding: var(--space-2) var(--space-3);
  }

  .pagefind-result-item {
    display: flex;
    flex-direction: column;
    gap: var(--space-1);
    padding: var(--space-3);
    background-color: var(--color-surface-900);
    border-radius: var(--radius-sm);
    border: 1px solid var(--color-surface-700);
    transition: all var(--transition-base);
    min-height: 44px;
    text-decoration: none;
  }

  .pagefind-result-item:hover {
    background-color: var(--color-surface-750);
    border-color: var(--color-primary);
  }

  .pagefind-result-item:focus-visible {
    outline: 2px solid var(--color-primary);
    outline-offset: 2px;
    border-radius: var(--radius-sm);
  }

  .pagefind-result-title {
    font-weight: 500;
    color: var(--color-text-white);
    font-size: var(--font-size-sm);
  }

  .pagefind-result-excerpt {
    font-size: var(--font-size-xs);
    color: var(--color-text-muted);
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
    line-height: 1.5;
  }

  #pagefind-results::-webkit-scrollbar {
    width: var(--space-1);
  }

  #pagefind-results::-webkit-scrollbar-thumb {
    background: var(--color-surface-700);
    border-radius: 3px;
  }

  #pagefind-results::-webkit-scrollbar-thumb:hover {
    background: var(--color-surface-600);
  }
</style>
